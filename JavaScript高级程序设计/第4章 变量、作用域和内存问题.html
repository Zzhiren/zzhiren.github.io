<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第4章 变量、作用域和内存问题 | Zzhiren</title>
    <meta name="description" content="纸人">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.902f0b1a.css" as="style"><link rel="preload" href="/assets/js/app.29d5f40c.js" as="script"><link rel="preload" href="/assets/js/2.c96d4765.js" as="script"><link rel="preload" href="/assets/js/18.2618d799.js" as="script"><link rel="preload" href="/assets/js/4.3e6fb65a.js" as="script"><link rel="prefetch" href="/assets/js/10.de744193.js"><link rel="prefetch" href="/assets/js/11.4bd533c9.js"><link rel="prefetch" href="/assets/js/12.e8efc8a5.js"><link rel="prefetch" href="/assets/js/13.44ed3116.js"><link rel="prefetch" href="/assets/js/14.f8de194c.js"><link rel="prefetch" href="/assets/js/15.4eccdcb0.js"><link rel="prefetch" href="/assets/js/16.22ec5580.js"><link rel="prefetch" href="/assets/js/17.68b68806.js"><link rel="prefetch" href="/assets/js/19.7770945c.js"><link rel="prefetch" href="/assets/js/20.d52735b8.js"><link rel="prefetch" href="/assets/js/21.18a499c1.js"><link rel="prefetch" href="/assets/js/22.2f763ec0.js"><link rel="prefetch" href="/assets/js/23.2896776a.js"><link rel="prefetch" href="/assets/js/24.ce81241f.js"><link rel="prefetch" href="/assets/js/25.495d8d38.js"><link rel="prefetch" href="/assets/js/3.2c15a986.js"><link rel="prefetch" href="/assets/js/5.745b38d5.js"><link rel="prefetch" href="/assets/js/6.68a3cdf3.js"><link rel="prefetch" href="/assets/js/7.3f9ba99b.js"><link rel="prefetch" href="/assets/js/8.60c49b86.js"><link rel="prefetch" href="/assets/js/9.1c5b16a4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.902f0b1a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zzhiren</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript高级程序设计/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-item"><!----> <a href="/深入浅出Nodejs/" class="nav-link">《深入浅出Nodejs》</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">Vue.js</a></li><li class="dropdown-item"><!----> <a href="/Egg/" class="nav-link">Egg.js</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript高级程序设计/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-item"><!----> <a href="/深入浅出Nodejs/" class="nav-link">《深入浅出Nodejs》</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">Vue.js</a></li><li class="dropdown-item"><!----> <a href="/Egg/" class="nav-link">Egg.js</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript高级程序设计</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/" class="sidebar-link">书名《JavaScript高级程序设计》</a></li><li><a href="/JavaScript高级程序设计/第1章 JavaScript简介.html" class="sidebar-link">第1章 JavaScript简介</a></li><li><a href="/JavaScript高级程序设计/第2章 在HTML中使用JavaScript.html" class="sidebar-link">第2章 在HTML中使用JavaScript</a></li><li><a href="/JavaScript高级程序设计/第3章 基本概念.html" class="sidebar-link">第3章 基本概念</a></li><li><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html" class="active sidebar-link">第4章 变量、作用域和内存问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-1-基本类型和引用类型的值" class="sidebar-link">4.1 基本类型和引用类型的值</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-1-1-动态的属性" class="sidebar-link">4.1.1 动态的属性</a></li><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-1-2-复制变量值" class="sidebar-link">4.1.2 复制变量值</a></li><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-1-3-传递参数" class="sidebar-link">4.1.3 传递参数</a></li><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-1-4-检测类型" class="sidebar-link">4.1.4 检测类型</a></li></ul></li><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-2-执行环境及作用域" class="sidebar-link">4.2 执行环境及作用域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-2-1-延长作用域链" class="sidebar-link">4.2.1 延长作用域链</a></li><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-2-2-没有块级作用域" class="sidebar-link">4.2.2 没有块级作用域</a></li></ul></li><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-3-垃圾收集" class="sidebar-link">4.3 垃圾收集</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-3-1-标记清除" class="sidebar-link">4.3.1 标记清除</a></li><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-3-2-引用计数" class="sidebar-link">4.3.2 引用计数</a></li><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-3-3-性能问题" class="sidebar-link">4.3.3 性能问题</a></li><li class="sidebar-sub-header"><a href="/JavaScript高级程序设计/第4章 变量、作用域和内存问题.html#_4-3-4-管理内存" class="sidebar-link">4.3.4 管理内存</a></li></ul></li></ul></li><li><a href="/JavaScript高级程序设计/第5章 引用类型.html" class="sidebar-link">第5章 引用类型</a></li><li><a href="/JavaScript高级程序设计/练习题.html" class="sidebar-link">练习题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第4章-变量、作用域和内存问题"><a href="#第4章-变量、作用域和内存问题" class="header-anchor">#</a> 第4章 变量、作用域和内存问题</h1> <h2 id="_4-1-基本类型和引用类型的值"><a href="#_4-1-基本类型和引用类型的值" class="header-anchor">#</a> 4.1 基本类型和引用类型的值</h2> <ul><li>按值访问，可以直接操作保存在变量中的实际的值
<ul><li>Undefined</li> <li>Null</li> <li>Boolean</li> <li>Number</li> <li>String</li></ul></li> <li>按引用访问
<ul><li>Object</li></ul></li></ul> <h3 id="_4-1-1-动态的属性"><a href="#_4-1-1-动态的属性" class="header-anchor">#</a> 4.1.1 动态的属性</h3> <h3 id="_4-1-2-复制变量值"><a href="#_4-1-2-复制变量值" class="header-anchor">#</a> 4.1.2 复制变量值</h3> <ul><li>基本类型值（两个变量值一样，当时相互独立）</li> <li>引用类型值（复制的是引用地址值，相互独立，但两个变量的值仍然指向同一个对象）</li></ul> <h3 id="_4-1-3-传递参数"><a href="#_4-1-3-传递参数" class="header-anchor">#</a> 4.1.3 传递参数</h3> <blockquote><p>所有函数的参数都是按值传递的</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 示例1</span>
<span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'Alice'</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// obj存储着对象的地址值 0x000000</span>

<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span>obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// o 保存着对象的地址 0x000000，与外部的obj指向同一个对象</span>
  <span class="token keyword">let</span> n <span class="token operator">=</span> num<span class="token punctuation">;</span> <span class="token comment">// 100</span>
  <span class="token keyword">let</span> o <span class="token operator">=</span> obj<span class="token punctuation">;</span> <span class="token comment">// 指向 {name:'Alice'}</span>
<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 示例2</span>
<span class="token keyword">function</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Alice'</span><span class="token punctuation">;</span>
  obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Tom'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setName</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Alice</span>

</code></pre></div><blockquote><p><code>setName()</code>的内部<code>obj</code>会在函数执行完成后被销毁</p></blockquote> <h3 id="_4-1-4-检测类型"><a href="#_4-1-4-检测类型" class="header-anchor">#</a> 4.1.4 检测类型</h3> <ul><li><code>typeof</code> 只能检测基本类型，引用类型一律返回 <code>Object</code></li> <li><code>instanceof</code> 检测引用类型</li></ul> <blockquote><p><code>instanceof</code> 检测的缺点，只要是引用类型的都属于 <code>Object</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// instanceof 的缺点</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
arr <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>

test <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><h2 id="_4-2-执行环境及作用域"><a href="#_4-2-执行环境及作用域" class="header-anchor">#</a> 4.2 执行环境及作用域</h2> <p>概念</p> <ul><li>函数执行环境</li> <li>执行环境栈</li> <li>作用域/作用域链</li></ul> <blockquote><p>分析执行环境与作用域</p></blockquote> <p>分析：</p> <ul><li>创建 <code>one()</code> 执行环境，压栈</li> <li>调用 <code>two()</code> ，创建 <code>tow()</code> 执行环境，压栈</li> <li>调用 <code>three()</code> ，创建 <code>three()</code> 执行环境，压栈</li> <li><code>three()</code> 执行完成，出栈，继续执行 <code>tow()</code></li> <li><code>two()</code> 执行完成，出栈，继续执行 <code>one()</code></li> <li><code>one()</code> 执行完成，出栈</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 执行环境</span>
<span class="token keyword">function</span> <span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>'<span class="token function">tow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>出栈‘<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'创建two()的执行环境，并压栈'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">three</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">three</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>'<span class="token function">创建three</span><span class="token punctuation">(</span><span class="token punctuation">)</span>的执行环境，并压栈‘<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'three'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用域</span>
<span class="token keyword">function</span> <span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token string">'person'</span>

  <span class="token keyword">function</span> <span class="token function">man</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'Tom'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以访问person的变量</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">woman</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token number">170</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以访问person的变量</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 会报错，因为无法访问到man的变量</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">man</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">woman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>总结：js在执行到函数时，会创建执行环境，执行环境中保存着变量对象和作用域链，作用域链中保存可以访问的变量对象的地址，所以当一个函数自身未定义某个变量时，会沿着作用域链查找，当查找到需要的变量时立即停止查找，如果知道查找到全局执行环境还未查询到改变了则会返回未定义。</p> <p><code>拓展: 下面函数的打印顺序</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            i <span class="token operator">==</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-2-1-延长作用域链"><a href="#_4-2-1-延长作用域链" class="header-anchor">#</a> 4.2.1 延长作用域链</h3> <ul><li><code>try-catch</code> 语句的 <code>catch</code> 块</li> <li><code>with</code> 语句</li></ul> <blockquote><p><code>catch</code> 块会在进入catch块时在作用域链前端创建一个新的变量对象，其中包含的是被排除的错误对象的声明</p></blockquote> <blockquote><p><code>width</code> 会在作用域链前端添加一个变量对象</p></blockquote> <p>示例</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>one()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>clickOne<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>two()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>clickTwo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">var</span> withObj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'withObj'</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">one</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

 <span class="token keyword">function</span> <span class="token function">two</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">let</span> two <span class="token operator">=</span> <span class="token string">'two'</span>
   <span class="token keyword">with</span><span class="token punctuation">(</span>withObj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>withObj<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>通过chrome调试工具可以看到scope中新创建的变量对象</p></blockquote> <div class="view-image" data-v-1d2566bc><img src="/img/with.jpeg" alt="查看大图" data-v-1d2566bc></div> <br> <div class="view-image" data-v-1d2566bc><img src="/img/catch.jpeg" alt="查看大图" data-v-1d2566bc></div> <h3 id="_4-2-2-没有块级作用域"><a href="#_4-2-2-没有块级作用域" class="header-anchor">#</a> 4.2.2 没有块级作用域</h3> <p>其他类C语言中被花括号封闭的代码都拥有自己的作用域<code>(称为块级作用域)</code>外部无法访问块级作用域内定义的内容，<code>但JS并没有这样的块级作用域</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> color <span class="token operator">=</span> <span class="token string">'blue'</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span>  <span class="token comment">// 'blue'</span>
</code></pre></div><p>1.声明变量</p> <ul><li><code>const</code> 声明一个 <code>只读</code> 的常量</li> <li><code>let</code> 声明的变量不会出现变量提升</li> <li><code>var</code> 声明变量会出现变量提升</li></ul> <p>示例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在chrome console 中运行查看效果</span>
<span class="token keyword">const</span> sex <span class="token operator">=</span> <span class="token string">'男'</span>
sex <span class="token operator">=</span> <span class="token string">'女'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'Zzhiren'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>
<span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token string">'26'</span>
</code></pre></div><h2 id="_4-3-垃圾收集"><a href="#_4-3-垃圾收集" class="header-anchor">#</a> 4.3 垃圾收集</h2> <p>垃圾收集机制的原理：找出不再被使用的变量，定时清除这些变量，释放内存。</p> <p>标记无用变量的两种策略</p> <ul><li>标记清除</li> <li>引用计数</li></ul> <h3 id="_4-3-1-标记清除"><a href="#_4-3-1-标记清除" class="header-anchor">#</a> 4.3.1 标记清除</h3> <p>标记清除基本原理：</p> <ul><li>垃圾收集器给所有存储在内存中的变量加上标记</li> <li>排除使用中的变量，剩余变量将被视为准备删除的变量</li> <li>垃圾收集器下次运行时会清除被标记的变量占用的内存</li></ul> <p>哪些变量为使用中的变量</p> <blockquote><p>执行环境中的变量，被环境中变量引用的变量都被视为使用中的变量</p></blockquote> <h3 id="_4-3-2-引用计数"><a href="#_4-3-2-引用计数" class="header-anchor">#</a> 4.3.2 引用计数</h3> <p>引用计数基本原理：</p> <ul><li>一个引用类型的 <code>值</code> 被一个变量引用，<code>值</code> 的引用计数 +1</li> <li>如果一个变量移除了对该 <code>值</code> 的引用，<code>值</code> 的引用计数 -1</li> <li>当一个值的引用计数微0时，垃圾收集器下次运行时回清除 <code>值</code> 所占用的内存</li></ul> <p>引用计数存在的问题：循环引用</p> <blockquote><p>当两个对象相互引用时会造成循环引用，导致对象已经离开执行环境，但引用计数仍然 <code>&gt;0</code> ,此时垃圾收集器无法会后对象占用的内存</p></blockquote> <p>示例：对象相互引用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> objA <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Zzhiren'</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> objB <span class="token operator">=</span> <span class="token punctuation">{</span>
  age<span class="token punctuation">:</span> <span class="token string">'26'</span>
<span class="token punctuation">}</span>

objA<span class="token punctuation">.</span>b <span class="token operator">=</span> objB
objB<span class="token punctuation">.</span>a <span class="token operator">=</span> objA
</code></pre></div><h3 id="_4-3-3-性能问题"><a href="#_4-3-3-性能问题" class="header-anchor">#</a> 4.3.3 性能问题</h3> <p>IE7出现的性能问题：</p> <blockquote><p>早期版本的IE7的垃圾收集器是根据内存分配量运行的，当一个脚本中的变量定义达到了IE7设置的阈值将会触发垃圾收集器的运行</p></blockquote> <p>导致的问题：</p> <blockquote><p>当一个脚本中定义的变量超过这个阈值且脚本的生命周期未结束时，将会频繁触发垃圾收集器工作，这将会导致IE7的性能问题</p></blockquote> <p>解决方案：</p> <blockquote><p>垃圾收集器的内存分配量阈值设置一个默认值，当垃圾收集器回收的内存量 <code>低于15%</code> 时，说明当前运行的脚本内存占用较多，调大 <code>阈值(翻倍)</code> ，避免频繁启动垃圾收集器；若垃圾收集器回收的内存量 <code>大于85%</code> 时，说明当前运行的脚本内存占用较少，将 <code>阈值重置为默认值</code></p></blockquote> <h3 id="_4-3-4-管理内存"><a href="#_4-3-4-管理内存" class="header-anchor">#</a> 4.3.4 管理内存</h3> <ul><li><code>解除引用</code>：针对全局变量使用，将不使用的变量置为 <code>null</code> 释放引用，此时变量将会被标记为待删除变量，下次垃圾收集器运行时将会回收其内存</li> <li>局部变量在离开其执行环境时会被自动解除引用</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/JavaScript高级程序设计/第3章 基本概念.html" class="prev">第3章 基本概念</a></span> <span class="next"><a href="/JavaScript高级程序设计/第5章 引用类型.html">第5章 引用类型</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.29d5f40c.js" defer></script><script src="/assets/js/2.c96d4765.js" defer></script><script src="/assets/js/18.2618d799.js" defer></script><script src="/assets/js/4.3e6fb65a.js" defer></script>
  </body>
</html>
